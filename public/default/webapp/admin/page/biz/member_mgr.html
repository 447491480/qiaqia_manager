<div id="biz_member_list_panel">
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;">
        <legend>客户列表</legend>
    </fieldset>

    <blockquote class="layui-elem-quote">
        <div>
            <button class="layui-btn layui-btn-small"><i class="layui-icon">&#xe608;</i> 新增</button>
            <button class="layui-btn layui-btn-small"><i class="layui-icon">&#x1002;</i> 刷新</button>
        </div>
    </blockquote>

    <div class="layui-input-inline ">
        <input type="text" lay-verify="required" placeholder="客户名称" autocomplete="off" align="right"
               class="layui-input">
    </div>
    <div class="layui-input-inline ">
        <input type="text" lay-verify="required" placeholder="客户编码" autocomplete="off" align="right"
               class="layui-input">
    </div>
    <button class="layui-btn "> 查询</button>

    <div style="margin-top: 10px;">
        <table id="biz_relation_list_grid" class="jqgrid-table"></table>
        <div id="biz_relation_list_grid_pager"></div>
    </div>
</div>

<div id="biz_member_select_custom_panel" style="display: none;">
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;">
        <legend>选择客户</legend>
    </fieldset>

    <blockquote class="layui-elem-quote">
        <div>
            <button class="layui-btn layui-btn-small"><i class="layui-icon">&#xe603;</i> 返回客户列表</button>
        </div>
    </blockquote>
    <div class="layui-input-inline ">
        <input type="text" lay-verify="required" placeholder="客户名称" autocomplete="off" align="right"
               class="layui-input">
    </div>
    <div class="layui-input-inline ">
        <input type="text" lay-verify="required" placeholder="客户编码" autocomplete="off" align="right"
               class="layui-input">
    </div>
    <button class="layui-btn "> 查询</button>

    <div style="margin-top: 10px;margin-bottom: 10px;">
        <table id="biz_member_list_grid" class="jqgrid-table"></table>
        <div id="biz_member_list_grid_pager"></div>
    </div>
</div>

<div id="biz_member_edit_panel" style="display: none;">
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;">
        <legend>新增客户</legend>
    </fieldset>

    <blockquote class="layui-elem-quote">
        <div>
            <button class="layui-btn layui-btn-small"><i class="layui-icon">&#xe603;</i> 返回客户列表</button>
        </div>
    </blockquote>
    <form class="layui-form layui-form-pane" action="javascript:;">
        <div class="layui-form-item">
            <label class="layui-form-label">客户名称</label>
            <div class="layui-input-inline">
                <input type="text" lay-verify="required" name="MemberName" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">客户角色</label>
            <div class="layui-input-inline">
                <select name="RoleId">
                    <option></option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">地址</label>
            <div class="layui-input-inline">
                <input type="text" lay-verify="required" name="Address" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">地区</label>
            <div class="layui-input-block">
                <ul id = "biz_member_region_tree" class="ztree" style="height: 200px;overflow-y: scroll;
                border-right: 1px solid #e6e6e6;border-left: 1px solid #e6e6e6;border-bottom: 1px solid #e6e6e6;">
                </ul>
            </div>
        </div>
        <div id="biz_member_BU_dispaly" class="layui-form-item layui-form-text" style="display: none">
            <label class="layui-form-label">BU</label>
            <div class="layui-input-block">
                <ul id = "biz_member_BU_tree" class="ztree" style="height: 200px;overflow-y: scroll;
                border-right: 1px solid #e6e6e6;border-left: 1px solid #e6e6e6;border-bottom: 1px solid #e6e6e6;">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">账号</label>
            <div class="layui-input-inline">
                <input type="text" lay-verify="required" name="MemberAccount" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">默认密码</label>
            <label class="layui-form-label" style="color:#ff0000">111111</label>
            <!--<div class="layui-input-inline">
                <input type="text" name="DefaultPassword" autocomplete="off" class="layui-input" disabled = "disabled" value = "111111">
            </div>-->
        </div>

        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit="" lay-filter="biz_member_edit_confirm" onclick="return false">
                    立即提交
                </button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</div>

<div id="biz_member_info_panel" style="display: none;">
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;">
        <legend>详细信息</legend>
    </fieldset>
    <blockquote class="layui-elem-quote">
        <div>
            <button class="layui-btn layui-btn-small"><i class="layui-icon">&#xe603;</i> 返回客户列表</button>
        </div>
    </blockquote>
    <div class="layui-form-item">
        <div class="layui-form-item">
            <label class="layui-form-label">积分</label>
            <div class="layui-input-inline">
                <input id="biz_shop_points" type="text" name="points" autocomplete="off" class="layui-input" disabled="disabled">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">总资产</label>
            <div class="layui-input-inline">
                <input id="biz_shop_asset" type="text" name="asset" autocomplete="off" class="layui-input" disabled="disabled">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">联系方式</label>
            <div class="layui-input-inline">
                <input id="biz_shop_communication" type="text" name="communication" autocomplete="off" class="layui-input" disabled="disabled">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">电子邮箱</label>
            <div class="layui-input-inline">
                <input id="biz_shop_email" type="text" name="email" autocomplete="off" class="layui-input" disabled="disabled">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">联系人</label>
            <div class="layui-input-inline">
                <input id="biz_shop_contactor" type="text" name="contactor" autocomplete="off" class="layui-input" disabled="disabled">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">司办</label>
            <div class="layui-input-inline">
                <input id="biz_shop_memberoffice" type="text" name="memberoffice" autocomplete="off" class="layui-input" disabled="disabled">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">竞争态势</label>
            <div class="layui-input-inline">
                <input id="biz_shop_compete" type="text" name="compete" autocomplete="off" class="layui-input" disabled="disabled">
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    layui.use(['commonUtil', 'form', 'ajaxUtil','validationUtil'], function () {
        var commonUtil = layui.commonUtil;
        var form = layui.form();
        var ajaxUtil = layui.ajaxUtil;
        var validationUtil = layui.validationUtil;

        var urls = {};
        urls.biz_member_query = '/admin/user/query-all';
        urls.biz_member_save = '/admin/user/save';
        urls.biz_member_delete = '/admin/user/delete';
        urls.biz_member_relation = '/admin/user/relation';
        urls.admin_role_query = '/admin/role/role-list';
        urls.biz_relation_set_payment = '/admin/user/set-payment-days';

        urls.biz_relation_query = '/admin/user/relation-list';
        urls.biz_relation_delete = '/admin/user/relation-delete';

        urls.biz_region_query = '/admin/tree/nodes-query';
        urls.biz_role_search = '/admin/role/role-search';
        urls.biz_BU_query = '/admin/tree/nodes-query';

        var controls = {};
        controls.biz_member_list_panel = $('#biz_member_list_panel');
        controls.biz_member_select_custom_panel = $('#biz_member_select_custom_panel');
        controls.biz_member_edit_panel = $('#biz_member_edit_panel');
        controls.biz_member_BU_div= $('#biz_member_BU_dispaly');
        controls.biz_member_info_panel = $('#biz_member_info_panel');

        var M = {};
        M.MODIFY_STATUS = false;
        M.DATA = null;

        var settingRegion = {
            check: {
                enable: true,
                chkStyle:"radio",
                radioType: "all"
            },
            view: {
                dbClickExpand: false
            },
            data: {
                simpleData: {
                    enable: true
                }
            }
        };

        var settingBU = {
            check: {
                enable: true,
                chkStyle:"radio",
                radioType: "all"
            },
            view: {
                dbClickExpand: false
            },
            data: {
                simpleData: {
                    enable: true
                }
            }
        };

        function init() {
            bindEvent();
            loadMemberData();
            loadRelationData();
        }

        function bindEvent() {
            //自定义验证规则
            form.verify({
                price: [/^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$/, '请输入小数']
            });

            // 监听提交
            form.on('submit(biz_member_edit_confirm)', function (data) {
                var args = data.field;
                if ($('#biz_member_BU_dispaly').css('display') == 'block') {
                    var zTreeBU = $.fn.zTree.getZTreeObj("biz_member_BU_tree");
                    var checkedBUNodes = zTreeBU.getCheckedNodes(true);
                    var bTemp = null;
                    layui.each(checkedBUNodes, function (i, nodesObj) {
                        if (nodesObj.checked == true) {
                            console.log(nodesObj);
                            bTemp = nodesObj.Position;
                        }
                    });
                    if (bTemp) {
                        args.MemberBU = bTemp;
                    } else {
                        return commonUtil.toast('请选择BU');
                    }
                }
                var zTreeRegion = $.fn.zTree.getZTreeObj("biz_member_region_tree");
                var checkedRegionNodes = zTreeRegion.getCheckedNodes(true);
                var rTemp = null;
                layui.each(checkedRegionNodes,function(i,nodesObj) {
                    if(nodesObj.checked == true) {
//                        rTemp = nodesObj.name;
//                        while(nodesObj.getParentNode()) {
//                            nodesObj = nodesObj.getParentNode();
//                            rTemp = nodesObj.name + '|' + rTemp;
//                        }
                        rTemp = nodesObj.Position;
                    }
                });
                console.log(rTemp);
                if(rTemp) {
                    args.MemberArea = rTemp;
                } else {
                    return commonUtil.toast('请选择地区');
                }
                if (M.MODIFY_STATUS) {
                    args.id = M.DATA.Id;
                }

                ajaxUtil.doAjaxPost(urls.biz_member_save, args).done(function (ret) {
                    commonUtil.toast(ret.msg);

                    if (ret.status == 0) {
                        controls.biz_member_edit_panel.find('button:eq(0)').trigger('click');

                        refreshRelation();
                    }
                });

                return false;
            });

            // 点击增加
            controls.biz_member_list_panel.find('button:eq(0)').bind('click', function () {
                var confirmLayer = layer.confirm('选择增加方式', {
                    btn: ['自己创建', '从已有客户中选择', '取消'] //按钮
                }, function () {
                    layer.close(confirmLayer);
                    showAddPanel();
                    controls.biz_member_edit_panel.find('button:eq(2)').trigger('click');
                    $.when(initRoleSelect(),initRegionTreeList(),initBUTreeList()).done(function(ret,retRegion){
                        var selector = controls.biz_member_edit_panel.find('select:eq(0)');
                        selector.empty();
                        layui.each(ret.data, function (i, o) {
                            selector.append('<option value="' + o.Id + '">' + o.RoleName + '</option>');
                        });
                        form.render();
                    })
                }, function () {
                    showEditPanel();
                    refresh();
                }, function () {
                });
            });

            //刷新
            controls.biz_member_list_panel.find('button:eq(1)').bind('click', function () {
                var args = {
                    name:'',
                    code:''
                };
                refreshRelation(args);
            });

            //搜索
            controls.biz_member_list_panel.find('button:eq(2)').bind('click', function () {
                var args = {};
                args.name = $.trim(controls.biz_member_list_panel.find('input[type=text]:eq(0)').val());
                args.code = $.trim(controls.biz_member_list_panel.find('input[type=text]:eq(1)').val());
                console.log(args);
                refreshRelation(args);
            });

            // 删除
            $("#biz_relation_list_grid").on({
                'click': function () {
                    var data = JSON.parse(decodeURIComponent($(this).data('relation')));

                    var confirmLayer = layer.confirm('确定删除？', {
                        btn: ['确定', '取消'] //按钮
                    }, function () {
                        layer.close(confirmLayer);
                        ajaxUtil.doAjaxGet(urls.biz_relation_delete, {'id': data.Id}).done(function (ret) {
                            commonUtil.toast(ret.msg);
                            if (ret.status == 0) {
                                refreshRelation();
                            }
                        });
                    }, function () {
                    });
                }
            }, '.biz-relation-delete');
            //设置账期
            $("#biz_relation_list_grid").on({
                'click': function () {
                    var data = JSON.parse(decodeURIComponent($(this).data('relation')));

                    layer.prompt({title: '请输入账期（单位：天）', formType: 0}, function (days, index) {
                        if(!validationUtil.isPositiveWholeNumber(days)) {
                            return commonUtil.toast('请输入正整数');
                        }

                        layer.close(index);
                        ajaxUtil.doAjaxGet(urls.biz_relation_set_payment, {days: days, id: data.Id}).done(function (ret) {
                            commonUtil.toast(ret.msg);
                            refreshRelation()
                        })
                    });
                }
            }, '.biz-relation-set');
            //显示商家详细信息
            $("#biz_relation_list_grid").on({
                'click': function () {
                    var data = JSON.parse(decodeURIComponent($(this).data('relation')));
                    $('#biz_shop_points').val(data.shop.Points);
                    $('#biz_shop_asset').val(data.shop.Asset);
                    $('#biz_shop_communication').val(data.shop.Communication);
                    $('#biz_shop_email').val(data.shop.Email);
                    $('#biz_shop_contactor').val(data.shop.Contacter);
                    $('#biz_shop_memberoffice').val(data.shop.MemberOffice);
                    $('#biz_shop_compete').val(data.shop.Compete);
                    showPanel(controls.biz_member_info_panel);
                }
            }, '.biz-relation-info');

            // 点击返回
            controls.biz_member_select_custom_panel.find('button:eq(0)').bind('click', function () {
                showListPanel();
            });
            controls.biz_member_info_panel.find('button:eq(0)').bind('click', function () {
                showPanel(controls.biz_member_list_panel);
            })

            // 自建商品点击返回
            controls.biz_member_edit_panel.find('button:eq(0)').bind('click',function(){
                showListPanel();
            });

            // 查询我的客户
            controls.biz_member_select_custom_panel.find('button:eq(1)').bind('click', function () {
                var args = {};
                args.name = $.trim(controls.biz_member_select_custom_panel.find('input[type=text]:eq(0)').val());
                args.region = $.trim(controls.biz_member_select_custom_panel.find('input[type=text]:eq(1)').val());
                args.bu = $.trim(controls.biz_member_select_custom_panel.find('input[type=text]:eq(2)').val());
                refresh(args);
            });

            // 修改
            $("#biz_member_list_grid").on({
                'click': function () {
                    var data = JSON.parse(decodeURIComponent($(this).data('member')));

                    showEditPanel();
                    controls.biz_member_select_custom_panel.find('input:eq(0)').val(data.MemberName);

                    controls.biz_member_select_custom_panel.find('select:eq(0)').val(data.RoleId);

                    controls.biz_member_select_custom_panel.find('input:eq(2)').val(data.Address);
                    controls.biz_member_select_custom_panel.find('input:eq(3)').val(data.MemberArea);
                    controls.biz_member_select_custom_panel.find('input:eq(4)').val(data.MemberBU);
                    controls.biz_member_select_custom_panel.find('input:eq(5)').val(data.member.MemberAccount);

                    controls.biz_member_select_custom_panel.find('input:eq(5)').attr('disabled', 'disabled');

                    form.render();

                    M.MODIFY_STATUS = true;
                    M.DATA = data;
                }
            }, '.biz-member-modify');

            // 删除
            $("#biz_member_list_grid").on({
                'click': function () {
                    var data = JSON.parse(decodeURIComponent($(this).data('member')));

                    var confirmLayer = layer.confirm('确定删除？', {
                        btn: ['确定', '取消'] //按钮
                    }, function () {
                        layer.close(confirmLayer);
                        ajaxUtil.doAjaxGet(urls.biz_member_delete, {'id': data.Id}).done(function (ret) {
                            commonUtil.toast(ret.msg);
                            if (ret.status == 0) {
                                refresh();
                            }
                        });
                    }, function () {
                    });
                }
            }, '.biz-member-delete');

            // 设为下级
            $("#biz_member_list_grid").on({
                'click': function () {
                    var data = JSON.parse(decodeURIComponent($(this).data('member')));

                    ajaxUtil.doAjaxGet(urls.biz_member_relation, {'sid': data.Id}).done(function (ret) {
                        commonUtil.toast(ret.msg);
                        if (ret.status == 0) {
                            refreshRelation();
                        }
                    });

                }
            }, '.biz-member-relation');
        }

        function initRoleSelect() {
            var def = $.Deferred();
            ajaxUtil.doAjaxGet(urls.admin_role_query, {type:1}).done(function (ret) {
                def.resolve(ret);
            });

            return def.promise();
        }

        function initBUTreeList() {
            ajaxUtil.doAjaxGet(urls.biz_role_search).done(function (res) {
                if(res.status == 0 && res.data.Id == 1){
                    controls.biz_member_BU_div.show();
                    var def = $.Deferred();
                    ajaxUtil.doAjaxGet(urls.biz_BU_query, {type:2}).done(function (ret) {
                        if(ret.status != 0) {
                            commonUtil.toast('初始化列表失败!');
                            return;
                        }
                        var nodes = ret.data;
                        if (nodes) {
                            for (var i = 0; i < nodes.length; i++) {
                                nodes[i].name = nodes[i].Name;
                                nodes[i].id = nodes[i].Id;
                                nodes[i].pId = nodes[i].ParentId;
                            }
                        }
                        $.fn.zTree.init($("#biz_member_BU_tree"),settingBU,nodes);
                        def.resolve(true);
                    });
                    return def.promise();
                }
            });
        }

        function initRegionTreeList() {
            var def = $.Deferred();
            ajaxUtil.doAjaxGet(urls.biz_region_query, {type:0}).done(function (ret) {
                if (ret.status != 0) {
                    commonUtil.toast('初始化列表失败!');
                    return;
                }
                var treenode = [];
                var nodes = ret.data;
                if (nodes) {
                    for (var i = 0; i < nodes.length; i++) {
                        var node = {};
                        if(nodes[i].Level == 0) {
                            node.nocheck = true;
                        }
//                        var names = nodes[i].Name.split("|");
//                        node.name = names[nodes[i].Level];
                        node.name = nodes[i].Name;
                        node.id = nodes[i].Id;
                        node.pId = nodes[i].ParentId;
                        node.Position = nodes[i].Position;
                        treenode.push(node);
                    }
                }
                $.fn.zTree.init($("#biz_member_region_tree"), settingRegion, treenode);
                def.resolve(true);
            });

            return def.promise();
        }

        function showEditPanel() {
            controls.biz_member_select_custom_panel.show();
            controls.biz_member_list_panel.hide();
            controls.biz_member_edit_panel.hide();
        }

        function showListPanel() {
            controls.biz_member_select_custom_panel.hide();
            controls.biz_member_list_panel.show();
            controls.biz_member_edit_panel.hide();
        }

        function showAddPanel() {
            controls.biz_member_select_custom_panel.hide();
            controls.biz_member_list_panel.hide();
            controls.biz_member_edit_panel.show();
        }

        function showPanel(target) {
            controls.biz_member_select_custom_panel.hide();
            controls.biz_member_list_panel.hide();
            controls.biz_member_edit_panel.hide();
            controls.biz_member_info_panel.hide();
            target.show();
        }

        function refreshRelation(data) {
            var page = $("#biz_relation_list_grid").getGridParam('page'); // current page
            var rows = $("#biz_relation_list_grid").getGridParam('rows'); // rows
            $("#biz_relation_list_grid").jqGrid('setGridParam', {
                page: page,
                rows: rows,
                postData: data
            }).trigger("reloadGrid");
        }

        function refresh(data) {
            data = data || {};
            var page = $("#biz_member_list_grid").getGridParam('page'); // current page
            var rows = $("#biz_member_list_grid").getGridParam('rows'); // rows
            $("#biz_member_list_grid").jqGrid('setGridParam', {
                page: page,
                rows: rows,
                postData: data
            }).trigger("reloadGrid")
        }

        function loadMemberData() {
            $("#biz_member_list_grid").jqGrid({
                colModel: [
                    {label: '客户名称', name: 'MemberName', align: 'center'},
                    {
                        label: '客户角色',
                        name: 'RoleId',
                        align: 'center',
                        formatter: function (cellValue, options, rowObject) {
                            return rowObject.role.RoleName;
                        }
                    },
                    {label: '地址', name: 'Address', align: 'center'},
                    {label: '地区', name: 'MemberArea', align: 'center',
                        formatter: function (cellValue, options, rowObject) {
                            return rowObject.MemberAreaStr;
                        }
                    },
                    {label: '部门', name: 'MemberBU', align: 'center',
                        formatter: function (cellValue, options, rowObject) {
                            return rowObject.MemberBUStr;
                        }
                    },
                    {
                        label: '主账号',
                        name: 'MemberAccount',
                        align: 'center',
                        formatter: function (cellValue, options, rowObject) {
                            return rowObject.member.MemberAccount;
                        }
                    },
                    {label: '总积分', name: 'Points', align: 'center'},
                    {label: '总资产', name: 'Asset', align: 'center'},
                    {
                        label: '创建时间',
                        name: 'CreateTime',
                        align: 'center',
                        formatter: function (cellValue, options, rowObject) {
                            return commonUtil.getTimeString(cellValue);
                        }
                    },
                    {
                        label: '操作',
                        align: 'center',
                        width: '210',
                        formatter: function (cellValue, options, rowObject) {
                            var _dom =
//                              '<span data-member="'+encodeURIComponent(JSON.stringify(rowObject))+'" href="javascript:;" class="my-grid-a-span biz-member-relation">设为下级</span>/<span data-member="'+encodeURIComponent(JSON.stringify(rowObject))+'" href="javascript:;" class="my-grid-a-span biz-member-modify">修改</span>/<span data-member="'+encodeURIComponent(JSON.stringify(rowObject))+'" href="javascript:;" class="my-grid-a-span biz-member-delete">删除</span>';
                                '<span data-member="' + encodeURIComponent(JSON.stringify(rowObject)) + '" href="javascript:;" class="my-grid-a-span biz-member-relation">设为我的客户</span>';

                            return _dom;
                        }
                    }
                ],
                datatype: 'json',
                url: urls.biz_member_query,
                rowNum: 10,
                rowList: [10, 20, 30],
                viewrecords: true, // show the current page, data rang and total records on the toolbar
                height: true,
                fitColumns: true,
                width: true,
                autowidth: true,
                shrinkToFit: true,
                ajaxGridOptions: {
                    dataFilter: function (ret) {
                        var retObj = JSON.parse(ret);
                        if (retObj.status == 0) {
                            return JSON.stringify(retObj.data);
                        } else {
                            commonUtil.toast(retObj.msg);
                        }
                    }
                },
                pager: "#biz_member_list_grid_pager"
            });

            // 初始化宽宽，用于自适应宽度
            $("#biz_member_list_grid").setGridWidth($("#admin-tab-container").width() - 10, true);
        }

        function loadRelationData() {
            $("#biz_relation_list_grid").jqGrid({
                colModel: [
                    {
                        label: '客户编码',
                        name: 'ShopCode',
                        align: 'center',
                        formatter: function (cellValue, options, rowObject) {
                            return commonUtil.filter(rowObject.shop.ShopCode);
                        }
                    },
                    {
                        label: '客户名称',
                        name: 'MemberName',
                        align: 'center',
                        formatter: function (cellValue, options, rowObject) {
                            return rowObject.shop.MemberName;
                        }
                    },
                    {
                        label: '客户级别',
                        name: 'RoleId',
                        align: 'center',
                        formatter: function (cellValue, options, rowObject) {
                            if(rowObject.shop.RoleId == 2){
                                return "经销商";
                            } else if(rowObject.shop.RoleId == 3){
                                return "分销商";
                            } else if(rowObject.shop.RoleId == 4){
                                return "门店";
                            }
                            return "下级";
                        }
                    },
                    {
                        label: '地址',
                        name: 'Address',
                        align: 'center',
                        formatter: function (cellValue, options, rowObject) {
                            return commonUtil.filter(rowObject.shop.Address);
                        }
                    },
                    {
                        label: '地区',
                        name: 'MemberArea',
                        align: 'center',
                        formatter: function (cellValue, options, rowObject) {
                            return commonUtil.filter(rowObject.shop.MemberAreaStr);
                        }
                    },
                    {
                        label: 'BU',
                        name: 'MemberBU',
                        align: 'center',
                        formatter: function (cellValue, options, rowObject) {
                            return commonUtil.filter(rowObject.shop.MemberBUStr);
                        }
                    },
                    {
                        label: '主账号',
                        name: 'MemberAccount',
                        align: 'center',
                        formatter: function (cellValue, options, rowObject) {
                            return commonUtil.filter(rowObject.member.MemberAccount);
                        }
                    },
                    {
                        label: '状态',
                        name: 'IsChecked',
                        align: 'center',
                        formatter: function (cellValue, options, rowObject) {
                            if(rowObject.shop.IsChecked === 1) {
                                return '已审核';
                            } else {
                                return '待审核';
                            }
                        }
                    },
                    {
                        label: '账期',
                        name: 'PaymentDays',
                        align: 'center'
                    },
                    {
                        label: '操作', align: 'center', formatter: function (cellValue, options, rowObject) {
                        var _dom =
                            '<span data-relation="' + encodeURIComponent(JSON.stringify(rowObject))
                            + '" href="javascript:;" class="my-grid-a-span biz-relation-set">账期</span>/'

                            + '<span data-relation="' + encodeURIComponent(JSON.stringify(rowObject))
                            + '" href="javascript:;" class="my-grid-a-span biz-relation-delete">移除客户</span>/'

                            + '<span data-relation="' + encodeURIComponent(JSON.stringify(rowObject))
                            + '" href="javascript:;" class="my-grid-a-span biz-relation-info">详情</span>'


                        return _dom;
                    }
                    }
                ],
                datatype: 'json',
                url: urls.biz_relation_query,
                rowNum: 10,
                rowList: [10, 20, 30],
                viewrecords: true, // show the current page, data rang and total records on the toolbar
                height: true,
                fitColumns: true,
                width: true,
                autowidth: true,
                shrinkToFit: true,
                ajaxGridOptions: {
                    dataFilter: function (ret) {
                        var retObj = JSON.parse(ret);
                        if (retObj.status == 0) {
                            return JSON.stringify(retObj.data);
                        } else {
                            commonUtil.toast(retObj.msg);
                        }
                    }
                },
                pager: "#biz_relation_list_grid_pager"
            });

            // 初始化宽宽，用于自适应宽度
            $("#biz_relation_list_grid").setGridWidth($("#admin-tab-container").width() - 10, true);
        }


        (function () {
            init();
        })();
    });
</script>